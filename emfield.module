<?php
// $Id$

/**
 * @file
 * Embedded Media Field is a CCK-based framework for embedding media files.
 */

/**
 * Implementation of hook_menu().
 */
function emfield_menu() {
  $items = array();

  // If we require legacy support, then load the old menu items.
  if (emfield_check_for_deprecated_modules()) {
    $items = _emfield_deprecated_menu();
  }

  return $items;
}

/**
 * Legacy support for deprecated functionality.
 *
 * If we're using a deprecated module, which expects emfield to support version
 * 1 or 2 functionality, then we need to include the legacy functions.
 *
 * @param boolean $reset
 *  If TRUE, then reset our static variable and recheck for the requirement.
 * @return boolean
 *  Return TRUE if we loaded the legacy support.
 */
function emfield_check_for_deprecated_modules($reset = FALSE) {
  static $support_legacy;

  if (!isset($support_legacy) || $reset) {
    $support_legacy = FALSE;
    foreach (array('emvideo', 'emimage', 'emaudio', 'emwave') as $module) {
      if (module_exists($module)) {
        module_load_include('inc', 'emfield', 'deprecated/emfield-deprecated');
        return $support_legacy = TRUE;
      }
    }
  }
  return $support_legacy;
}

// Always check for the requirement of legacy support.
emfield_check_for_deprecated_modules();
